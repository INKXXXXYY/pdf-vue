## 项目目标
- **构建一个基于 Vue 3 + TypeScript + PDF.js + Stirling PDF 的在线 PDF 编辑器**，支持在线预览、注释（高亮/文本/形状）、页面操作（缩放/旋转/缩略图/跳转）、搜索、导出（客户端或通过 Stirling PDF 服务端处理）。

## 分阶段任务

### 第 0 阶段：准备与方案敲定
- [ ] 明确 Stirling PDF 的可用 API（是否有 REST/HTTP 接口可供前端调用：旋转/合并/拆分/水印/签章/压缩/OCR/转换/表单扁平化等）。
- [ ] 设计整体架构：前端（Vue3+TS+PDF.js）+ 可选后端（Stirling PDF 自托管服务）+ 代理层（本地 `vite` 代理或 Nginx）。
- [ ] 确定编辑实现策略：
  - [ ] 渲染和注释层：PDF.js 渲染画布 + 前端矢量/DOM 覆盖层。
  - [ ] 导出策略 A（客户端）：将覆盖层扁平化合成到 PDF（考虑 `pdf-lib`）；
  - [ ] 导出策略 B（服务端）：将编辑指令提交给 Stirling PDF，由其生成新 PDF。
- [ ] 明确跨域、安全、文件体积与性能方案。

### 第 1 阶段：项目初始化
- [ ] 使用 Vite 初始化 Vue 3 + TypeScript 工程。
- [ ] 配置别名、环境变量（`VITE_STIRLING_BASE_URL`）。
- [ ] 安装依赖：`pdfjs-dist`、类型声明、工具库（可选：`pdf-lib`）。
- [ ] 基础目录结构与路由：`/viewer` 主页面。

### 第 2 阶段：PDF 基础查看器
- [x] 通过 PDF.js 加载与渲染多页 PDF（支持本地上传/URL 加载）。
- [x] 工具栏：放大/缩小、页面跳转、旋转、适配宽度/页面。
- [x] 侧栏缩略图与大纲/书签（若有）。
- [x] 文本搜索（页级匹配跳转；后续增强为高亮）。

### 第 3 阶段：注释与编辑层
- [ ] 交互图层（Overlay）：
  - [ ] 文本框（字体、大小、颜色、粗斜体、可拖拽缩放）。
  - [ ] 高亮笔（矩形/自由画笔，颜色与透明度）。
  - [ ] 基础形状（矩形/椭圆/箭头）。
  - [ ] 撤销/重做。
  - [ ] 对齐与吸附（可选）。
- [ ] 图层数据结构设计、跨页管理、持久化（内存/本地存储）。

### 第 4 阶段：导出与保存
- [ ] 导出（客户端方案）：
  - [ ] 将每页画布与注释层合成，生成新 PDF（优先 `pdf-lib`）。
  - [ ] 进度反馈与大文件处理优化。
- [ ] 导出（服务端方案）：
  - [ ] 与 Stirling PDF 对接：上传原 PDF + JSON 指令（文本/高亮/水印/旋转等），获取生成文件。
  - [ ] 下载与本地保存。

### 第 5 阶段：Stirling PDF 能力透出
- [ ] 文件级操作：合并、拆分、旋转、压缩、加密/解密、提取页面、OCR、格式转换（PDF<->图片/Office）。
- [ ] 在 UI 中集成为工具面板，调用 Stirling PDF API 完成任务。
- [ ] 队列/任务状态与错误提示。

### 第 6 阶段：文件与权限
- [ ] 限制文件大小与格式检查。
- [ ] 跨域与认证（若 Stirling PDF 受保护，配置 Token/Basic Auth）。
- [ ] 断点续传（可选）。

### 第 7 阶段：打包与部署
- [ ] 本地开发代理至 Stirling PDF。
- [ ] 生产打包与静态资源优化。
- [ ] Docker 化前端（可选），与 Stirling PDF 一起 compose。

## 验收标准（DoD）
- [ ] 核心查看功能稳定（加载、分页、缩放、旋转、搜索、缩略图）。
- [ ] 注释层可用（文本/高亮/形状），支持撤销/重做与跨页。
- [ ] 至少一种稳定导出路径（客户端或服务端）。
- [ ] Stirling PDF 常用能力在 UI 可用（合并/拆分/旋转/压缩/转换）。
- [ ] 关键步骤、思考、坑位均记录在 `cursorlog.md`。


